<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Week 7: Automation Bias Analysis</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial; padding:20px; background:#f7f9fc; line-height:1.6;}
    .container{max-width:1200px; margin:0 auto;}
    .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:20px; border-radius:8px; margin-bottom:20px;}
    .controls{background:white; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin-bottom:20px;}
    .input-group{margin-bottom:15px;}
    .input-group label{display:block; margin-bottom:5px; font-weight:600; color:#333;}
    .input-group input, .input-group select{padding:10px; border:1px solid #ddd; border-radius:4px; font-size:14px; width:100%; max-width:300px;}
    .btn{background:#667eea; color:white; border:none; padding:12px 24px; border-radius:4px; cursor:pointer; font-size:14px; font-weight:600; transition:background 0.2s;}
    .btn:hover{background:#5a6fd8;}
    .btn:disabled{background:#ccc; cursor:not-allowed;}
    .status{margin-top:10px; padding:10px; border-radius:4px; background:#f0f8ff; border-left:4px solid #667eea;}
    .results{display:grid; gap:20px; margin-top:20px;}
    .topic-card{background:white; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
    .topic-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding-bottom:10px; border-bottom:1px solid #eee;}
    .topic-title{font-size:18px; font-weight:600; color:#333;}
    .bias-severity{padding:4px 8px; border-radius:4px; font-size:12px; font-weight:600; text-transform:uppercase;}
    .severity-high{background:#ffebee; color:#c62828;}
    .severity-medium{background:#fff3e0; color:#ef6c00;}
    .severity-low{background:#e8f5e8; color:#2e7d32;}
    .stats{display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:15px; margin:15px 0;}
    .stat{background:#f8f9fa; padding:15px; border-radius:6px; text-align:center; border-left:4px solid #667eea;}
    .stat-value{font-size:24px; font-weight:700; color:#333; margin-bottom:5px;}
    .stat-label{font-size:12px; color:#666; text-transform:uppercase; letter-spacing:0.5px;}
    .bias-indicators{margin-top:15px;}
    .bias-indicator{background:#fff3cd; border:1px solid #ffeaa7; padding:10px; margin:5px 0; border-radius:4px; border-left:4px solid #f39c12;}
    .bias-indicator.high{background:#ffebee; border-color:#ffcdd2; border-left-color:#f44336;}
    .bias-indicator.medium{background:#fff3e0; border-color:#ffcc02; border-left-color:#ff9800;}
    .indicator-type{font-weight:600; color:#333; margin-bottom:5px;}
    .indicator-desc{color:#666; font-size:14px;}
    .page-results{margin-top:15px;}
    .page-result{background:#f8f9fa; padding:10px; margin:5px 0; border-radius:4px; border-left:3px solid #667eea;}
    .page-title{font-weight:600; color:#333; margin-bottom:5px;}
    .page-link{color:#667eea; text-decoration:none; font-weight:600;}
    .page-link:hover{color:#5a6fd8; text-decoration:underline;}
    .page-stats{font-size:12px; color:#666;}
    .loading{text-align:center; padding:40px; color:#666;}
    .spinner{border:3px solid #f3f3f3; border-top:3px solid #667eea; border-radius:50%; width:30px; height:30px; animation:spin 1s linear infinite; margin:0 auto 10px;}
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .error{background:#ffebee; color:#c62828; padding:15px; border-radius:4px; border-left:4px solid #f44336; margin:10px 0;}
    .summary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:20px; border-radius:8px; margin-bottom:20px;}
    .summary h3{margin:0 0 15px 0;}
    .summary-stats{display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:15px;}
    .summary-stat{text-align:center;}
    .summary-stat-value{font-size:28px; font-weight:700; margin-bottom:5px;}
    .summary-stat-label{font-size:12px; opacity:0.9; text-transform:uppercase; letter-spacing:0.5px;}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ü§ñ Week 7: Automation Bias Analysis</h1>
      <p>Analyzing how automated agents influence knowledge representation on Wikipedia</p>
    </div>

    <div class="controls">
      <h3>Research Configuration</h3>
      <div class="input-group">
        <label for="topic">Controversial Topic to Analyze:</label>
        <select id="topic">
          <option value="climate change">Climate Change</option>
          <option value="vaccination">Vaccination</option>
          <option value="artificial intelligence">Artificial Intelligence</option>
          <option value="gun control">Gun Control</option>
          <option value="abortion">Abortion</option>
          <option value="immigration">Immigration</option>
          <option value="renewable energy">Renewable Energy</option>
          <option value="genetic engineering">Genetic Engineering</option>
          <option value="social media">Social Media</option>
          <option value="cryptocurrency">Cryptocurrency</option>
        </select>
      </div>
      <div class="input-group">
        <label for="pages">Pages to Analyze:</label>
        <input type="number" id="pages" value="3" min="1" max="10">
      </div>
      <div class="input-group">
        <label for="revisions">Revisions per Page:</label>
        <input type="number" id="revisions" value="30" min="10" max="100">
      </div>
      <button id="analyze" class="btn">üîç Analyze Automation Bias</button>
      <div id="status" class="status">Ready to analyze automation bias patterns</div>
    </div>

    <div id="summary" class="summary" style="display:none;">
      <h3>üìä Analysis Summary</h3>
      <div class="summary-stats" id="summaryStats"></div>
    </div>

    <div id="results" class="results"></div>
  </div>

  <script>
    const analyzeBtn = document.getElementById('analyze');
    const status = document.getElementById('status');
    const results = document.getElementById('results');
    const summary = document.getElementById('summary');
    const summaryStats = document.getElementById('summaryStats');

    analyzeBtn.onclick = async () => {
      const topic = document.getElementById('topic').value;
      const pages = document.getElementById('pages').value;
      const revisions = document.getElementById('revisions').value;
      
      status.innerHTML = '<div class="loading"><div class="spinner"></div>Analyzing real Wikipedia articles...</div>';
      results.innerHTML = '';
      summary.style.display = 'none';
      
      try {
        // Call the real API
        const response = await fetchRealAnalysis(topic, pages, revisions);
        displayResults(response);
      } catch (error) {
        console.error('Real API failed:', error);
        status.innerHTML = `
          <div class="error">
            ‚ùå Real API failed: ${error.message}<br>
            <small>Make sure the API server is running: <code>python week7_api.py</code></small>
          </div>
        `;
      }
    };

    async function fetchRealAnalysis(topic, pages, revisions) {
      // Call the real Flask API
      const apiUrl = `http://localhost:5002/api/analyze?topic=${encodeURIComponent(topic)}&pages=${pages}&revisions=${revisions}`;
      
      try {
        console.log('Fetching real data from:', apiUrl);
        const response = await fetch(apiUrl, {
          method: 'GET',
          mode: 'cors',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          }
        });
        
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('API error response:', errorText);
          throw new Error(`API request failed: ${response.status} - ${errorText}`);
        }
        
        const data = await response.json();
        console.log('Real data received:', data);
        return data;
      } catch (error) {
        console.error('API call failed:', error);
        throw new Error(`Failed to fetch real Wikipedia data: ${error.message}`);
      }
    }

    function generateMockAnalysis(topic, pages, revisions) {
      const topics = {
        'climate change': { botRatio: 0.65, biasSeverity: 'high', indicators: 4 },
        'vaccination': { botRatio: 0.45, biasSeverity: 'medium', indicators: 2 },
        'artificial intelligence': { botRatio: 0.72, biasSeverity: 'high', indicators: 5 },
        'gun control': { botRatio: 0.38, biasSeverity: 'medium', indicators: 3 },
        'abortion': { botRatio: 0.55, biasSeverity: 'high', indicators: 4 },
        'immigration': { botRatio: 0.42, biasSeverity: 'medium', indicators: 2 },
        'renewable energy': { botRatio: 0.68, biasSeverity: 'high', indicators: 3 },
        'genetic engineering': { botRatio: 0.58, biasSeverity: 'medium', indicators: 3 },
        'social media': { botRatio: 0.48, biasSeverity: 'medium', indicators: 2 },
        'cryptocurrency': { botRatio: 0.75, biasSeverity: 'high', indicators: 6 }
      };
      
      const topicData = topics[topic] || { botRatio: 0.5, biasSeverity: 'medium', indicators: 2 };
      
      const totalEdits = pages * revisions;
      const botEdits = Math.floor(totalEdits * topicData.botRatio);
      
      const biasIndicators = [
        {
          type: 'high_bot_ratio',
          description: `High bot edit ratio (${(topicData.botRatio * 100).toFixed(1)}%) may indicate automated bias`,
          severity: topicData.botRatio > 0.7 ? 'high' : 'medium'
        },
        {
          type: 'citation_bias',
          description: 'Bots and humans show different citation patterns (bot: +2.3, human: -0.8)',
          severity: 'medium'
        },
        {
          type: 'content_amplification_bias',
          description: 'Bots are responsible for most content amplification',
          severity: 'medium'
        }
      ].slice(0, topicData.indicators);
      
      const pageResults = [];
      for (let i = 0; i < pages; i++) {
        const pageBotRatio = topicData.botRatio + (Math.random() - 0.5) * 0.2;
        const pageEdits = revisions;
        const pageBotEdits = Math.floor(pageEdits * pageBotRatio);
        
        const pageTitle = `${topic} - Page ${i + 1}`;
        const pageUrl = `https://en.wikipedia.org/wiki/${pageTitle.replace(/\s+/g, '_')}`;
        
        pageResults.push({
          title: pageTitle,
          pageid: 1000000 + i,
          page_url: pageUrl,
          total_edits: pageEdits,
          bot_edits: pageBotEdits,
          bot_ratio: pageBotRatio,
          bias_indicators: biasIndicators.slice(0, Math.floor(Math.random() * 3) + 1)
        });
      }
      
      return {
        topic: topic,
        pages_analyzed: pages,
        total_edits: totalEdits,
        total_bot_edits: botEdits,
        overall_bot_ratio: topicData.botRatio,
        bias_severity: topicData.biasSeverity,
        bias_indicators: biasIndicators,
        page_results: pageResults
      };
    }

    function displayResults(data) {
      status.innerHTML = `‚úÖ Analysis complete: ${data.pages_analyzed} pages, ${data.total_edits} edits analyzed`;
      
      // Show summary
      summary.style.display = 'block';
      summaryStats.innerHTML = `
        <div class="summary-stat">
          <div class="summary-stat-value">${data.pages_analyzed}</div>
          <div class="summary-stat-label">Pages Analyzed</div>
        </div>
        <div class="summary-stat">
          <div class="summary-stat-value">${data.total_edits}</div>
          <div class="summary-stat-label">Total Edits</div>
        </div>
        <div class="summary-stat">
          <div class="summary-stat-value">${(data.overall_bot_ratio * 100).toFixed(1)}%</div>
          <div class="summary-stat-label">Bot Ratio</div>
        </div>
        <div class="summary-stat">
          <div class="summary-stat-value">${data.bias_indicators.length}</div>
          <div class="summary-stat-label">Bias Indicators</div>
        </div>
      `;
      
      // Show detailed results
      results.innerHTML = `
        <div class="topic-card">
          <div class="topic-header">
            <div class="topic-title">üìå Topic: ${data.topic}</div>
            <div class="bias-severity severity-${data.bias_severity}">${data.bias_severity} bias</div>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">${data.pages_analyzed}</div>
              <div class="stat-label">Pages</div>
            </div>
            <div class="stat">
              <div class="stat-value">${data.total_edits}</div>
              <div class="stat-label">Total Edits</div>
            </div>
            <div class="stat">
              <div class="stat-value">${data.total_bot_edits}</div>
              <div class="stat-label">Bot Edits</div>
            </div>
            <div class="stat">
              <div class="stat-value">${(data.overall_bot_ratio * 100).toFixed(1)}%</div>
              <div class="stat-label">Bot Ratio</div>
            </div>
          </div>
          
          ${data.bias_indicators.length > 0 ? `
            <div class="bias-indicators">
              <h4>üö® Bias Indicators Detected:</h4>
              ${data.bias_indicators.map(indicator => `
                <div class="bias-indicator ${indicator.severity}">
                  <div class="indicator-type">${indicator.type.replace(/_/g, ' ').toUpperCase()}</div>
                  <div class="indicator-desc">${indicator.description}</div>
                </div>
              `).join('')}
            </div>
          ` : ''}
          
          <div class="page-results">
            <h4>üìÑ Page-by-Page Analysis:</h4>
            ${data.page_results.map(page => `
              <div class="page-result">
                <div class="page-title">
                  <a href="${page.page_url || '#'}" target="_blank" class="page-link">${page.title}</a>
                </div>
                <div class="page-stats">
                  ${page.total_edits} edits, ${page.bot_edits} bot edits (${(page.bot_ratio * 100).toFixed(1)}%), 
                  ${page.bias_indicators.length} bias indicators
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    // Auto-run analysis on page load
    window.onload = () => {
      console.log('Page loaded, starting real Wikipedia analysis...');
      analyzeBtn.click();
    };
  </script>
</body>
</html>
